"use strict";angular.module("myApp",["ngRoute","ui.bootstrap","config","myApp.youtube.service"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("config",[]).constant("ENV",{name:"production",apiUrl:"",socketUrl:""}),angular.module("myApp").controller("MainCtrl",["$rootScope","$scope","youtube","mySocket",function(a,b,c,d){function e(a){if("All favourites"===a)b.foundItems=b.favourites;else{var c=[];angular.forEach(b.favourites,function(b){b.category===a&&c.push(b)}),b.foundItems=c}}b.foundItems=[],b.searchValue="",b.nowPlaying,c.getFavouriteCategories().then(function(a){b.favouriteCategories=a}),c.getFavourites().then(function(a){b.favourites=a,b.foundItems=a}),a.$on("showFavourites",function(a,b){e(b.category)}),b.search=function(a){var d={query:a,limit:50};c.getMovies(d).then(function(a){b.foundItems=a&&a.data?a.data:[],b.searchValue=""})},b.playAll=function(){},d.on("loading",function(a){console.log("loading",a)}),d.on("video",function(a){var c=a.action,d=a.video;"play"===c?b.nowPlaying=d:"pause"===c?b.nowPlaying=d:"stop"===c&&(b.nowPlaying=null)}),d.on("playlist",function(a){b.playlist=a.data})}]),angular.module("myApp").controller("HeaderCtrl",["$rootScope","$scope","youtube",function(a,b,c){c.getFavouriteCategories().then(function(a){a.unshift("All favourites"),b.favouriteCategories=a}),b.showFavourites=function(b){a.$broadcast("showFavourites",{category:b})}}]);var app=angular.module("myApp");app.directive("myMovie",function(){return{scope:{movie:"=",playing:"=",favouriteCategories:"="},restrict:"E",replace:"true",templateUrl:"../../views/movie.html"}});var app=angular.module("myApp");app.directive("myMovieControls",["mySocket",function(a){return{scope:{movie:"=",playing:"=",favouriteCategories:"="},restrict:"E",replace:"true",templateUrl:"../../views/movie-controls.html",link:function(b){function c(b,c){b.category=c,a.emit("video",{action:"favourite",video:b})}b.play=function(){b.isLoading=!0,a.emit("video",{action:"play",video:b.movie})},b.pause=function(){a.emit("video",{action:"pause",video:b.movie})},b.stop=function(){a.emit("video",{action:"stop",video:b.movie})},b.addFavourite=function(a){c(b.movie,a)},b.createFavouriteCategory=function(){var a=window.prompt("Enter new category");a&&(b.favouriteCategories.push(a),c(b.movie,a))},b.addToQueue=function(){a.emit("video",{action:"queue",video:b.movie})},b.isPlaying=function(){var a=b.playing&&b.movie.id===b.playing.id;return a&&b.isLoading&&(b.isLoading=!1),a},b.isPaused=function(){return b.playing&&b.isPlaying()!==!1?b.playing.isPaused:!0}}}}]),angular.module("myApp.youtube.service",[]).factory("youtube",["$http","$q","ENV",function(a,b,c){function d(a,b){return a=angular.isArray(a)?a:[a],a.concat(b)}function e(a){var b,c=[];if(!a.feed.entry)return c;for(var d=0;d<a.feed.entry.length;d++)b=a.feed.entry[d],c.push({id:b.id.$t.split("/")[6],title:b.title.$t,preview:b.media$group.media$thumbnail[1].url,duration:b.media$group.yt$duration.seconds});return c}var f={},g=c.apiUrl||document.location.origin,h=function(){return"http://gdata.youtube.com/feeds/api/videos?alt=json"};return f.getMovies=function(b){return a.get(h()+"&&q="+escape(b.query)+"&max-results="+b.limit,{transformResponse:d(a.defaults.transformResponse,function(a){return e(a)})})},f.getFavouriteCategories=function(){return f.getFavourites().then(function(a){var b,c=[];return angular.forEach(a,function(a){b=a.category,b&&c.indexOf(b)<0&&c.push(b)}),c})},f.getFavourites=function(){return $.get(g+"/video/favourite")},f}]),angular.module("myApp").factory("mySocket",["$rootScope","ENV",function(a,b){var c=b.socketUrl||document.location.origin,d=io.connect(c);return{on:function(b,c){d.on(b,function(){var b=arguments;a.$apply(function(){c.apply(d,b)})})},emit:function(b,c,e){d.emit(b,c,function(){var b=arguments;a.$apply(function(){e&&e.apply(d,b)})})}}}]),angular.module("myApp").filter("secondsToString",function(){return function(a){a=parseInt(a,10);var b=parseInt(a/3600)%24,c=parseInt(a/60)%60,a=a%60,d=(10>b?"0"+b:b)+":"+(10>c?"0"+c:c)+":"+(10>a?"0"+a:a);return d}});