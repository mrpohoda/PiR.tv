"use strict";angular.module("myApp",["ngRoute","myApp.youtube.service"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("myApp").controller("MainCtrl",["$scope","$http","youtube","mySocket",function(a,b,c,d){a.foundItems=[],a.searchValue="",a.nowPlaying;var e=document.location.origin;a.search=function(b){var d={query:b,limit:12};c.getMovies(d).then(function(b){a.foundItems=b.data,a.searchValue=""})},a.play=function(b){return a.nowPlaying&&b.id===a.nowPlaying.id?void a.pause(b):(a.nowPlaying&&a.stop(a.nowPlaying),b.isPlaying=!0,a.nowPlaying=b,void d.emit("video",{action:"play",video_id:b.id}))},a.pause=function(a){a.isPlaying=!a.isPlaying,$.get(e+"/omx/pause",function(a){console.log(a)})},a.stop=function(b){b.isPlaying=!1,a.nowPlaying=null,$.get(e+"/omx/quit",function(a){console.log(a)})},a.showFavourites=function(){$.get(e+"/video/favourite",function(b){a.$apply(function(){a.foundItems=b})})},a.addFavourite=function(a){d.emit("video",{action:"favourite",video:a})},d.on("loading",function(a){console.log("loading",a)}),d.on("finish",function(){a.nowPlaying.isPlaying=!1,a.nowPlaying=null}),d.on("send:message",function(b){a.messages.push(b)}),d.on("change:name",function(a){changeName(a.oldName,a.newName)}),d.on("user:join",function(b){a.messages.push({user:"chatroom",text:"User "+b.name+" has joined."}),a.users.push(b.name)})}]),angular.module("myApp.youtube.service",[]).factory("youtube",["$http",function(a){function b(a,b){return a=angular.isArray(a)?a:[a],a.concat(b)}function c(a){for(var b,c=[],d=0;d<a.feed.entry.length;d++)b=a.feed.entry[d],c.push({id:b.id.$t.split("/")[6],title:b.title.$t,preview:b.media$group.media$thumbnail[1].url,duration:b.media$group.yt$duration.seconds});return c}var d={},e=function(){return"http://gdata.youtube.com/feeds/api/videos?alt=json"};return d.getMovies=function(d){return a.get(e()+"&&q="+escape(d.query)+"&max-results="+d.limit,{transformResponse:b(a.defaults.transformResponse,function(a){return c(a)})})},d}]),angular.module("myApp").factory("mySocket",["$rootScope",function(a){var b=document.location.origin,c=io.connect(b);return{on:function(b,d){c.on(b,function(){var b=arguments;a.$apply(function(){d.apply(c,b)})})},emit:function(b,d,e){c.emit(b,d,function(){var b=arguments;a.$apply(function(){e&&e.apply(c,b)})})}}}]),angular.module("myApp").filter("secondsToString",function(){return function(a){a=parseInt(a,10);var b=parseInt(a/3600)%24,c=parseInt(a/60)%60,a=a%60,d=(10>b?"0"+b:b)+":"+(10>c?"0"+c:c)+":"+(10>a?"0"+a:a);return d}});